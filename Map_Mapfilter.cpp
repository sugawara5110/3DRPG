//*****************************************************************************************//
//**                                                                                     **//
//**                   　　　	         Mapクラス                                       **//
//**                                    Mapfilter関数                                    **//
//*****************************************************************************************//

#include <string.h>
#include "Map.h"

void Map::Mapfilter(Position::H_Pos *h_p){

	char *mapfilter;
	blockcount = 0;
	squarecount = 0;
	r_point_count = 0;
	mo_count = 0;
	f_wall_count = 0;
	boss_count = 0;
	Elevator_count = 0;
	lightcount = 0;

	switch (map_no){
	case 0:
		mxy.z = 1; mxy.y = 30; mxy.x = 30;
		break;

	case 1:
		mxy.z = 1; mxy.y = 30; mxy.x = 40;
		break;
	case 2:
		mxy.z = 2; mxy.y = 30; mxy.x = 30;
		break;
	case 3:
		mxy.z = 2; mxy.y = 30; mxy.x = 30;
		break;
	case 4:
		mxy.z = 8; mxy.y = 30; mxy.x = 30;
		break;
	}

	mapfilter = (char*)malloc(sizeof(char) * mxy.z * mxy.y * mxy.x);

	switch (map_no){
	case 0:
	{
		char mapfilter0[1][30][31] =
		{
			"000111111111111111111111110000",
			"001464111110000001111111010000",
			"014000411011011111111111010000",
			"001434111011011111111111011111",
			"000101110011011111111110000010",
			"111101110111011111111110111110",
			"110000000000000000111100100000",
			"111111111111111110111101100000",
			"000000100111111110011101100000",
			"000000100000010000011000100000",
			"000000111111000011111100100000",
			"000000110000001111111100100000",
			"000000111111100000000000100000",
			"000000100000000111110001100000",
			"000000100011111111110011000000",
			"000000100111111000000111111110",
			"000000100000000001111111110010",
			"000000110000111111111111110010",
			"000000011001111111111110000110",
			"000000001001111111111110111111",
			"000000001001111111111110100001",
			"000000001001111111111110111111",
			"000000001004141111111110100000",
			"000000001000000000000000100000",
			"000000001110011111111111100000",
			"000000000013021000000000000000",
			"000000000140041000000000000000",
			"000000000140041000000000000000",
			"000000000140041000000000000000",
			"000000000011110000000000000000"
			// 0:通路48  1:壁49  2:回復ポイント50  3:ボス出現ポイント51  4:松明有り壁52  6:出口54
		};
		for (int k = 0; k < mxy.z; k++){
			for (int j = 0; j < mxy.y; j++){
				for (int i = 0; i < mxy.x; i++){
					mapfilter[k * mxy.y * mxy.x + j * mxy.x + i] = mapfilter0[k][j][i];
				}
			}
		}
	}
	if (h_p == NULL && MPos == POS_ST){
		cax1 = 1150.0f;
		cax2 = 1150.0f;
		cay1 = 2850.0f;
		cay2 = 2800.0f;
		posx = 11;
		posy = 28;
		posz = 0;
		src_theta = 0.0f;
	}
	if (h_p == NULL && MPos == POS_EN1){
		cax1 = 450.0f;
		cax2 = 450.0f;
		cay1 = 250.0f;
		cay2 = 300.0f;
		posx = 4;
		posy = 2;
		posz = 0;
		src_theta = 180.0f;
	}
	StartPos = 100;
	EndPos = 1000;
	r = 0x00;
	g = 0x00;
	b = 0x00;
	break;

	case 1:
	{
		char mapfilter1[1][30][41] =
		{
			"0551111111111111111111115550000000000000",
			"0555555556555555555555555550000000000000",
			"0555500050500000000000555550000000000000",
			"0555500053500000000000005550000000000000",
			"0555500000000000000000005550000000000000",
			"0555555555000005555000055050000000000000",
			"0555000000000000555555555050000000000000",
			"0555000000000000000000055050000000000000",
			"0555000000000005555000555055000000000000",
			"0555000000055000000000055555000000000000",
			"0555000000000000000000005555000000000000",
			"0555000000000000550055005555555550000000",
			"0555005555555000000555005555555550000000",
			"0555000000000000000000055555555550000000",
			"0555000000000000000000000000005550000000",
			"0555000000000000000000555555005555000000",
			"0555000005500500550550005505005555000000",
			"0555000000005550000005555505005555000000",
			"0555000000000000000000055505005555000000",
			"0555000000000000000000550555005555000000",
			"0555000555500000005555555555005000000000",
			"0555000055000000000000000555005000000000",
			"0555000000555500000000000555005000000000",
			"0555000000000000000000005555005555555555",
			"05552000005550000000550055550000000I0085",
			"0555000000000000000000000555005555555555",
			"0555000000000000000000000555005500000000",
			"0555000000101000000000000555005500000000",
			"0555000000171000000000000555555550000000",
			"0111111111111111111111111111000000000000"
			// 0:通路48  1:壁49  2:回復ポイント50  3:ボス出現ポイント51  5:壁(板)53  6:出口1 54  7:入口55  8:出口2 56  I:炎壁73
		};
		for (int k = 0; k < mxy.z; k++){
			for (int j = 0; j < mxy.y; j++){
				for (int i = 0; i < mxy.x; i++){
					mapfilter[k * mxy.y * mxy.x + j * mxy.x + i] = mapfilter1[k][j][i];
				}
			}
		}
	}
	if (h_p == NULL && MPos == POS_ST){
		cax1 = 1150.0f;
		cax2 = 1150.0f;
		cay1 = 2750.0f;
		cay2 = 2700.0f;
		posx = 11;
		posy = 27;
		posz = 0;
		src_theta = 0.0f;
	}
	if (h_p == NULL && MPos == POS_EN1){
		cax1 = 950.0f;
		cax2 = 950.0f;
		cay1 = 250.0f;
		cay2 = 300.0f;
		posx = 9;
		posy = 2;
		posz = 0;
		src_theta = 180.0f;
	}
	if (h_p == NULL && MPos == POS_EN2){
		cax1 = 3750.0f;
		cax2 = 3700.0f;
		cay1 = 2450.0f;
		cay2 = 2450.0f;
		posx = 37;
		posy = 24;
		posz = 0;
		src_theta = 270.0f;
	}
	StartPos = 2000;
	EndPos = 3000;
	r = 0xff;
	g = 0xff;
	b = 0xff;
	break;

	case 2:
	{
		char mapfilter2[2][30][31] =
		{
			{
				"111111111111111111111111111111",//0
				"161000000000000000000000000001",//1
				"101000000010000010000000000001",//2
				"101001111010000010000000000001",//3
				"101000000010000010000000000001",//4
				"131000000010011110000000000001",//5
				"101011100010000010000000000001",//6
				"101000000011110011111111110001",//7
				"101000000010000010000000000001",//8
				"101000000010000010000000000001",//9
				"101110011111111110000000000001",//10
				"100000000000000010000000111111",//11
				"111111111000000110000000000001",//12
				"100000000000000011110000000001",//13
				"111111111111111110000000000001",//14
				"101000000000000000000000000001",//15
				"111111111111111111111111111001",//16
				"100000000000000000000000000001",//17
				"100000000000000000000000011111",//18
				"111111111111111111100000000001",//19
				"100000000000000000100000000001",//20
				"100000000000000000111111000001",//21
				"101000000000000000000001000001",//22
				"101000000000000000000001000001",//23
				"101000000000200000000001001111",//24
				"101111111111111111000001000001",//25
				"101000000000000000000001000001",//26
				"101000000000000000000001000001",//27
				"171000000000000000000000000001",//28
				"111111111111111111111111111111" //29
				// 0:通路48  1:壁49  2:回復ポイント50  3:ボス出現ポイント51  6:出口54  7:入口55
			},
			{
				"111111111111111111111111111111",//0
				"101000000000000000000000000001",//1
				"101000000010000010000000000001",//2
				"101001111010000010000000000001",//3
				"101000000010000010000000000001",//4
				"101000000010011110000000000001",//5
				"101011100010000010000000000001",//6
				"101000000011110011111111110001",//7
				"101000000010000010000000000001",//8
				"101000000010000010000000000001",//9
				"101110011111111110000000000001",//10
				"101000000000000010000000111111",//11
				"101111111000000110000000000001",//12
				"100000000000000011110000000001",//13
				"101111111111111110000000000001",//14
				"111000000000000000000000000001",//15
				"111111111111111111111111111001",//16
				"100000000000000000000000000001",//17
				"100000000000000000000000011111",//18
				"111111111111111111100000000001",//19
				"100000000000000000100000000001",//20
				"100000000000000000111111000001",//21
				"101000000000000000000001000001",//22
				"101000000000000000000001000001",//23
				"101000000000000000000001001111",//24
				"101111111111111111000001000001",//25
				"101000000000000000000001000001",//26
				"101000000000000000000001000001",//27
				"101000000000000000000000000001",//28
				"111111111111111111111111111111" //29
			}
		};
		for (int k = 0; k < mxy.z; k++){
			for (int j = 0; j < mxy.y; j++){
				for (int i = 0; i < mxy.x; i++){
					mapfilter[k * mxy.y * mxy.x + j * mxy.x + i] = mapfilter2[k][j][i];
				}
			}
		}
	}
	if (h_p == NULL && MPos == POS_ST){
		cax1 = 150.0f;
		cax2 = 150.0f;
		cay1 = 2750.0f;
		cay2 = 2700.0f;
		posx = 1;
		posy = 27;
		posz = 0;
		src_theta = 0.0f;
	}
	if (h_p == NULL && MPos == POS_EN1){
		cax1 = 150.0f;
		cax2 = 150.0f;
		cay1 = 250.0f;
		cay2 = 300.0f;
		posx = 1;
		posy = 2;
		posz = 0;
		src_theta = 180.0f;
	}
	StartPos = 100;
	EndPos = 1000;
	r = 0x00;
	g = 0x00;
	b = 0x00;
	break;

	case 3:
	{
		char mapfilter3[2][30][31] =
		{
			{
				"111111111111111111111111111111",//0
				"1IIIIIIIIIIIIIIIIIIIIIIIIIIII1",//1
				"1I00000I00000000000000000000I1",//2
				"1I00000I00000000000000000000I1",//3
				"1I00000I00000000000000000000I1",//4
				"1III3III00000000000000000000I1",//5
				"1I0I0I0000000IIIIIII00IIIIIII1",//6
				"1I0I0I0000000I00000000000000I1",//7
				"1I00000000000I00000000000000I1",//8
				"1I00000000000I00000000000000I1",//9
				"1IIIIIIIIIIIIIIIIIIIIIIII000I1",//10
				"1I00000000000000000000000000I1",//11
				"1I00000000000000000000000000I1",//12
				"1IIIII00IIIIIIIIIIIIIIIIIIIII1",//13
				"1I00000000000000000000000000I1",//14
				"1I00000000000000000000000000I1",//15
				"1I00000000000000000000000000I1",//16
				"1I00000000000000000000000000I1",//17
				"1I0000IIIIIIIIIIIIIIIIIIIIIII1",//18
				"1I00000000000000000000000000I1",//19
				"1I00000000000000000000000000I1",//20
				"1I00000000000000000000000000I1",//21
				"1IIIIIIIIIIIIIIIIIIIIII00000I1",//22
				"1I00000000I00000000000000000I1",//23
				"1I00000002I00I00000000000000I1",//24
				"1I0I000000I00I000IIIIIIIIIIII1",//25
				"1I0I000000000I00000000000000I1",//26
				"1I0I000000I00I00000000000000I1",//27
				"1I7IIIIIIIIIIIIIIIIIIIIIIIIII1",//28
				"111111111111111111111111111111" //29
				// 0:通路48  1:壁49  2:回復ポイント50  3:ボス出現ポイント51  7:入口55  I:炎壁73
			},
			{
				"111111111111111111111111111111",//0
				"100000000000000000000000000001",//1
				"100000000000000000000000000001",//2
				"100000000000000000000000000001",//3
				"100000000000000000000000000001",//4
				"100000000000000000000000000001",//5
				"100000000000000000000000000001",//6
				"100000000000000000000000000001",//7
				"100000000000000000000000000001",//8
				"100000000000000000000000000001",//9
				"100000000000000000000000000001",//10
				"100000000000000000000000000001",//11
				"100000000000000000000000000001",//12
				"100000000000000000000000000001",//13
				"100000000000000000000000000001",//14
				"100000000000000000000000000001",//15
				"100000000000000000000000000001",//16
				"100000000000000000000000000001",//17
				"100000000000000000000000000001",//18
				"100000000000000000000000000001",//19
				"100000000000000000000000000001",//20
				"100000000000000000000000000001",//21
				"100000000000000000000000000001",//22
				"100000000000000000000000000001",//23
				"100000000000000000000000000001",//24
				"100000000000000000000000000001",//25
				"100000000000000000000000000001",//26
				"100000000000000000000000000001",//27
				"100000000000000000000000000001",//28
				"111111111111111111111111111111" //29
			}
		};
		for (int k = 0; k < mxy.z; k++){
			for (int j = 0; j < mxy.y; j++){
				for (int i = 0; i < mxy.x; i++){
					mapfilter[k * mxy.y * mxy.x + j * mxy.x + i] = mapfilter3[k][j][i];
				}
			}
		}
	}
	if (h_p == NULL && MPos == POS_ST){
		cax1 = 250.0f;
		cax2 = 250.0f;
		cay1 = 2750.0f;
		cay2 = 2700.0f;
		posx = 2;
		posy = 27;
		posz = 0;
		src_theta = 0.0f;
	}
	StartPos = 100;
	EndPos = 1000;
	r = 0x00;
	g = 0x00;
	b = 0x00;
	break;

	case 4:
	{
		char mapfilter4[8][30][31] =
		{
			{
				//1階
				"111111111111111111111111111111",//0
				"1A0000000010000001000000000001",//1
				"100000000010000001000000000001",//2
				"111111100010000004000000000001",//3
				"100000000010000000000000000001",//4
				"100000000010000004000000000001",//5
				"100000000000000001000000000001",//6
				"111111111111111111111110000001",//7
				"100000000000000110000000000001",//8
				"100000000000000011000011111111",//9
				"100000000000000001100000000001",//10
				"100000000000000000000000000001",//11
				"101111111111111111111111111111",//12
				"100000000000000000000000000001",//13
				"100000000000010000000000000001",//14
				"1A0000000000010000000000000001",//15
				"111111111111111111111111111111",//16
				"1000000000000000A10000000000A1",//17
				"100000000000000001000000000001",//18
				"100000000000000001000000000001",//19
				"1A0000000000000001000000000001",//20
				"1111111111111111111110000000A1",//21
				"100000000000000000001111111111",//22
				"1000000000A0020000001000000001",//23
				"100000000100010000001000000001",//24
				"100000000100010000001000000001",//25
				"100000000140410000001000000001",//26
				"100000000140410000000000000001",//27
				"111111111147411111111111111111",//28
				"111111111111111111111111111111" //29
			},
			{
				"111111111111111111111111111111",//0
				"100000000000000000000000000001",//1
				"100000000000000000000000000001",//2
				"100000000000000000000000000001",//3
				"100000000000000000000000000001",//4
				"100000000000000000000000000001",//5
				"100000000000000000000000000001",//6
				"100000000000000000000000000001",//7
				"100000000000000000000000000001",//8
				"100000000000000000000000000001",//9
				"100000000000000000000000000001",//10
				"100000000000000000000000000001",//11
				"100000000000000000000000000001",//12
				"100000000000000000000000000001",//13
				"100000000000000000000000000001",//14
				"100000000000000000000000000001",//15
				"100000000000000000000000000001",//16
				"100000000000000000000000000001",//17
				"100000000000000000000000000001",//18
				"100000000000000000000000000001",//19
				"100000000000000000000000000001",//20
				"100000000000000000000000000001",//21
				"100000000000000000000000000001",//22
				"100000000000000000000000000001",//23
				"100000000000000000000000000001",//24
				"100000000000000000000000000001",//25
				"100000000000000000000000000001",//26
				"100000000000000000000000000001",//27
				"111111111111111111111111111111",//28
				"111111111111111111111111111111" //29
			},
			{
				//2階の底
				"111111111111111111111111111111",//0
				"101110000000000000000000000001",//1
				"100010000000000000000000000001",//2
				"100010000000000000000000000001",//3
				"100010000000000000000000000001",//4
				"100010000000000000000000000001",//5
				"100010000000000000000000000001",//6
				"100010000000000000000000000001",//7
				"100010000000000000000000000001",//8
				"100010000000000000000000000001",//9
				"100010000000000000000000000001",//10
				"100010000000000000000000000001",//11
				"100010000000000000000000000001",//12
				"100010000000000000000000000001",//13
				"100010000000000000000000000001",//14
				"100010000000000000000000000011",//15
				"110010000000000000000000000011",//16
				"100010000000000001110000000001",//17
				"100010000000000000000000000001",//18
				"100010000010000000000000000001",//19
				"100010000010000000000000000001",//20
				"110010000010000000000000000001",//21
				"110040000011111111111111100011",//22
				"110040000000000000000000100011",//23
				"100041100000000000000000100011",//24
				"100040000000000000000000100011",//25
				"100040000000000000000000000011",//26
				"100040000000000000000000000001",//27
				"111111111111111111111111111111",//28
				"111111111111111111111111111111" //29
			},
			{
				//2階 壁透明
				"111111111111111111111111111111",//0
				"10000-000000000000000000000001",//1
				"1---0-000000000000000000000001",//2
				"100-0-000000000000000000000001",//3
				"100-0-000000000000000000000001",//4
				"100-0-000000000000000000000001",//5
				"100-0-000000000000000000000001",//6
				"100-0-000000000000000000000001",//7
				"100-0-000000000000000000000001",//8
				"100-0-000000000000000000000001",//9
				"100-0-000000000000000000000001",//10
				"100-0-000000000000000000000001",//11
				"100-0-000000000000000000000001",//12
				"100-0-000000000000000000000--1",//13
				"1---0-000000000000000000000-B1",//14
				"10--0-000000000000000000000-01",//15
				"10--0-000000000-------00000-01",//16
				"1B--0-000---000-0000B-00000-01",//17
				"1---0-000-B-000-------00000--1",//18
				"1---0-000-0-000000000000000001",//19
				"10--0-000-0-000000000000000001",//20
				"10--0-000-0---------------0--1",//21
				"10--0-000-000000000000000-0-01",//22
				"10--0-----0-------------0-0-01",//23
				"1B--000B----00000000000-0-0-01",//24
				"1---0----00000000000000-0-0-01",//25
				"100-0-B-000000000000000-B-0-01",//26
				"100-A---000000000000000---0-B1",//27
				"111111111111111111111111111111",//28
				"111111111111111111111111111111" //29
			},
			{
				"111111111111111111111111111111",//0
				"100000000000000000000000000001",//1
				"100000000000000000000000000001",//2
				"100000000000000000000000000001",//3
				"100000000000000000000000000001",//4
				"100000000000000000000000000001",//5
				"100000000000000000000000000001",//6
				"100000000000000000000000000001",//7
				"100000000000000000000000000001",//8
				"100000000000000000000000000001",//9
				"100000000000000000000000000001",//10
				"100000000000000000000000000001",//11
				"100000000000000000000000000001",//12
				"100000000000000000000000000001",//13
				"100000000000000000000000000001",//14
				"100000000000000000000000000001",//15
				"100000000000000000000000000001",//16
				"100000000000000000000000000001",//17
				"100000000000000000000000000001",//18
				"100000000000000000000000000001",//19
				"100000000000000000000000000001",//20
				"100000000000000000000000000001",//21
				"100000000000000000000000000001",//22
				"100000000000000000000000000001",//23
				"100000000000000000000000000001",//24
				"100000000000000000000000000001",//25
				"100000000000000000000000000001",//26
				"100000000000000000000000000001",//27
				"111111111111111111111111111111",//28
				"111111111111111111111111111111" //29
			},
			{
				//3階底
				"111111111111111111111111111111",//0
				"100000000000000000000000000001",//1
				"100000000000000000000000000001",//2
				"100000000000000000000000000001",//3
				"100000000000000000000000000001",//4
				"100000000000000000000000000001",//5
				"100000000000000000000000000001",//6
				"100000000000000000000000000001",//7
				"100000000000000000000000000001",//8
				"100000000000444440000000000001",//9
				"100000000004111114000000000001",//10
				"100000000041111111400000000001",//11
				"100000000004411144000000000001",//12
				"100000000000041400000000000001",//13
				"100000000000001000000000000001",//14
				"100000000000001000000000000001",//15
				"100000000000001000000000000001",//16
				"100000000000001000000000000001",//17
				"100000000000001000000000000001",//18
				"100000000000001000000000000001",//19
				"100000000000001000000000000001",//20
				"100000000000001000000000000001",//21
				"100000000000001000000000000001",//22
				"100000000000001000000000000001",//23
				"100000000000001000000000000001",//24
				"100000000000001000000000000001",//25
				"100000000000001000000000000001",//26
				"100001111111111000000000000001",//27
				"111111111111111111111111111111",//28
				"111111111111111111111111111111" //29
			},
			{
				//3階 壁透明
				"111111111111111111111111111111",//0
				"100000000000000000000000000001",//1
				"100000000000000000000000000001",//2
				"100000000000000000000000000001",//3
				"100000000000000000000000000001",//4
				"100000000000000000000000000001",//5
				"100000000000000000000000000001",//6
				"100000000000000000000000000001",//7
				"100000000000000000000000000001",//8
				"100000000000000000000000000001",//9
				"100000000000000000000000000001",//10
				"1000000000000---00000000000001",//11
				"1000000000000-0-00000000000001",//12
				"1000000000000-3-00000000000001",//13
				"1000000000000-0-00000000000001",//14
				"1000000000000-0-00000000000001",//15
				"1000000000000-0-00000000000001",//16
				"1000000000000-0-00000000000001",//17
				"1000000000000-0-00000000000001",//18
				"1000000000000-0-00000000000001",//19
				"1000000000000-0-00000000000001",//20
				"1000000000000-0-00000000000001",//21
				"1000000000000-0-00000000000001",//22
				"1000000000000-0-00000000000001",//23
				"1000000000000-0-00000000000001",//24
				"10000---00000-0-00000000000001",//25
				"100---B-------0-00000000000001",//26
				"1---00000000000-00000000000001",//27
				"111111111111111111111111111111",//28
				"111111111111111111111111111111" //29
			},
			{
				//3階 上側(天井まで狭いから付け足し)
				"111111111111111111111111111111",//0
				"100000000000000000000000000001",//1
				"100000000000000000000000000001",//2
				"100000000000000000000000000001",//3
				"100000000000000000000000000001",//4
				"100000000000000000000000000001",//5
				"100000000000000000000000000001",//6
				"100000000000000000000000000001",//7
				"100000000000000000000000000001",//8
				"100000000000000000000000000001",//9
				"100000000000000000000000000001",//10
				"100000000000000000000000000001",//11
				"100000000000000000000000000001",//12
				"100000000000000000000000000001",//13
				"100000000000000000000000000001",//14
				"100000000000000000000000000001",//15
				"100000000000000000000000000001",//16
				"100000000000000000000000000001",//17
				"100000000000000000000000000001",//18
				"100000000000000000000000000001",//19
				"100000000000000000000000000001",//20
				"100000000000000000000000000001",//21
				"100000000000000000000000000001",//22
				"100000000000000000000000000001",//23
				"100000000000000000000000000001",//24
				"100000000000000000000000000001",//25
				"100000000000000000000000000001",//26
				"100000000000000000000000000001",//27
				"111111111111111111111111111111",//28
				"111111111111111111111111111111" //29
			}
			// 0:通路48  1:壁49  2:回復ポイント50  3:ボス出現ポイント51  4:松明有り壁52  7:入口55  -:透明壁45 A:エレベーター上65 B:エレベーター下66
		};
		for (int k = 0; k < mxy.z; k++){
			for (int j = 0; j < mxy.y; j++){
				for (int i = 0; i < mxy.x; i++){
					mapfilter[k * mxy.y * mxy.x + j * mxy.x + i] = mapfilter4[k][j][i];
				}
			}
		}
	}
	if (h_p == NULL && MPos == POS_ST){
		cax1 = 1150.0f;
		cax2 = 1150.0f;
		cay1 = 2750.0f;
		cay2 = 2700.0f;
		posx = 11;
		posy = 27;
		posz = 0;
		src_theta = 0.0f;
	}
	StartPos = 100;
	EndPos = 1000;
	r = 0x00;
	g = 0x00;
	b = 0x00;
	break;
	}

	mxy.m = (int*)malloc(sizeof(int) * mxy.z * mxy.y * mxy.x);

	//頂点バッファ確保の為の個数カウント
	for (int k = 0; k < mxy.z; k++){
		for (int j = 0; j < mxy.y; j++){
			for (int i = 0; i < mxy.x; i++){
				mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] = mapfilter[k * mxy.y * mxy.x + j * mxy.x + i];
				if (mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 49 || mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 52)blockcount++;//1のアスキーコード49
				if (mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 50)r_point_count++;//2のアスキーコード50
				if (mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 52)mo_count++;
				if (mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 53)squarecount++;
				if (mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 51){
					if (boss_killed[map_no] == 1){
						mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] = 48;
					}
					else boss_count++;
				}
				if (mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 65 ||
					mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 66)Elevator_count++;
				if (mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] == 73){
					if (map_no == 1 && boss_killed[3] == 1){
						mxy.m[k * mxy.y * mxy.x + j * mxy.x + i] = 48;
					}
					else f_wall_count++;
				}
			}
		}
	}
	lightcount = mo_count * 4;//1ブロック最大4光源
	free(mapfilter);
	mapfilter = NULL;

	if (h_p != NULL){
		cax1 = h_p->cx1;
		cax2 = h_p->cx2;
		cay1 = h_p->cy1;
		cay2 = h_p->cy2;
		posx = h_p->px;
		posy = h_p->py;
		posz = h_p->pz;
		src_theta = h_p->theta;
	}
}